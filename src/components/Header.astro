---
import { Sun, Moon, Star } from "@lucide/astro";

const NAV_LINKS = [
    { title: "in√≠cio", link: "/"},
    { title: "blog", link: "/blog"},
    { title: "sobre", link: "/sobre"},
    { title: "software", link: "/software"},
    { title: "rss", link: "/rss.xml", newTab: true}, 
];

const currentPath = Astro.url.pathname;
---
<header class="flex justify-between items-center my-2 sm:my-4">
    <nav class="mt-2">
        <ul class="flex gap-1.5 sm:gap-3 text-center text-xs sm:text-sm">
        { NAV_LINKS.map((item, i) => {
            const isActive = item.link === '/' 
                ? currentPath === '/' 
                : currentPath.startsWith(item.link);

            return (
                <li class="font-semibold text-gray-800 dark:text-gray-200 flex gap-1.5 sm:gap-3 items-center">
                    
                    { i !== 0 && (
                        <Star class="w-2.5 h-2.5 sm:w-3 sm:h-3 text-gray-400" />
                    )}
                    
                    <a 
                        class:list={[
                            "transition-colors",
                            isActive 
                                ? "text-rose-300" 
                                : "hover:text-rose-300 hover:underline hover:decoration-1 hover:underline-offset-2"
                        ]}
                        href={ item.link }
                        target={ item.newTab ? "_blank" : "_self" }
                    >
                        { item.title }
                    </a>
                </li>
            )
        })}
        </ul>
    </nav>

    <button 
        id="theme-toggle"
        aria-label="Toggle Dark Mode"
        class="text-gray-800 dark:text-gray-200 hover:text-rose-300 transition-colors ml-2 sm:ml-0 mt-2"
    >
        <Sun class="w-3.5 h-3.5 sm:w-4 sm:h-4 hidden dark:block" />
        <Moon class="w-3.5 h-3.5 sm:w-4 sm:h-4 block dark:hidden" />
    </button>
</header>

<script is:inline>
    const theme = (() => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
            return localStorage.getItem('theme');
        }
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            return 'dark';
        }
        return 'light';
    })();

    if (theme === 'dark') {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }

    window.localStorage.setItem('theme', theme);

    const handleToggleClick = () => {
        const element = document.documentElement;
        element.classList.toggle("dark");

        const isDark = element.classList.contains("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
    }

    document.getElementById("theme-toggle").addEventListener("click", handleToggleClick);
</script>