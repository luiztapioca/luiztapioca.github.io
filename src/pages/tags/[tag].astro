---
import BaseLayout from "@layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
    const allPosts = await getCollection("posts", ({ data }) => {
        return import.meta.env.PROD ? data.draft !== true : true;
    });

    const uniqueTags = [...new Set(allPosts.flatMap(post => post.data.tags || []))];

    return uniqueTags.map((tag) => {
        const filteredPosts = allPosts
            .filter((post) => post.data.tags?.includes(tag))
            .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

        return {
            params: { tag },
            props: { posts: filteredPosts },
        };
    });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout title={`Tag: #${tag}`} description={`Posts marcados com ${tag}`}>
    <section class="mt-4 sm:mt-8">
        <h1 class="font-bold text-lg sm:text-2xl mb-6 sm:mb-8 font-jetbrains text-[#586e75] dark:text-[#eee8d5]">
            <span class="text-[#d33682] dark:text-[#d33682]">#</span> {tag}
        </h1>

        <ul class="flex flex-col gap-6 list-none p-0">
            {posts.map((post) => (
                <li class="flex flex-col">
                    <div class="flex justify-between items-baseline gap-4 w-full">
                        <a
                            href={`/blog/${post.id}/`}
                            class="
                                /* Mobile: text-sm | Desktop: text-lg */
                                text-sm sm:text-lg font-medium font-jetbrains

                                /* CORES BASE: Azul Solarized */
                                text-[#268bd2] dark:text-[#268bd2]

                                /* CORES HOVER: Magenta Solarized */
                                hover:text-[#d33682] dark:hover:text-[#d33682]

                                transition-colors
                                hover:underline decoration-1 underline-offset-2
                            "
                        >
                            {post.data.title}
                        </a>

                        <time
                            datetime={post.data.date.toISOString()}
                            class="
                                /* Mobile: xs | Desktop: sm */
                                text-xs sm:text-sm
                                /* Cores mutadas/suaves para as datas (base1/base01) */
                                text-[#93a1a1] dark:text-[#586e75] font-jetbrains whitespace-nowrap
                            "
                        >
                            {post.data.date.toLocaleDateString('pt-BR', {
                                day: '2-digit',
                                month: 'short',
                                year: 'numeric',
                            })}
                        </time>
                    </div>
                </li>
            ))}
        </ul>
    </section>
</BaseLayout>
